<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.acorn.springboardstudy.mapper.BoardMapper">
    <resultMap id="BoardMap" type="BoardDto">
        <id column="b_id" property="bId"/>
        <result column="content" property="content"/>
        <result column="title" property="title"/>
        <result column="u_id" property="uId"/>
        <result column="post_time" property="postTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="status" property="status"/>
        <result column="view_count" property="viewCount"/>
        <result column="login_user_like_status" property="loginUserLikeStatus"/> <!-- ìœ ì €ê°€ ì¢‹ì•„ìš”í•œ ë‚´ì—­ -->
        <!-- column : ì¡°íšŒ ê²°ê³¼ì˜ í…Œì´ë¸” í•œì¤„ì˜ ë‚´ì—­ (í…Œì´ë¸”ì˜ ë¡œìš°(íŠœí”Œ) ì¤‘ì˜ ë‚´ì—­) // íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ë‹¤.  -->
<!--        <association property="loginUserLike"-->
<!--                    select="com.acorn.springboardstudy.mapper.BoardLikeMapper.findByBIdAndUId"-->
<!--                     column="b_id,u_id">--> <!-- u_id ë¥¼ ì „ë‹¬í• ìˆ˜ì—†ë‹¤!! -->
<!--        </association>-->
        <association property="likes"
                        select="com.acorn.springboardstudy.mapper.BoardLikeMapper.countStatusByBId"
                        column="b_id"
                        fetchType="eager"/>
        <association property="user"
                    select="com.acorn.springboardstudy.mapper.UserMapper.findByUId"
                    column="u_id"
                    fetchType="lazy"/> <!-- ê¸€ì“´ì´ ìœ ì €ê°€ ëˆ„êµ°ì§€ í™•ì¸ --> <!-- ì»¬ë ‰ì…˜ì´ ê°€ìž¥ ì•„ëž˜ì— ìœ„ì¹˜ -->
        <!-- ì¡°ì¸í•˜ëŠ”ê²ƒì²˜ëŸ¼ í˜¸ì¶œë˜ê²Œ í•˜ëŠ” -->
        <collection property="replies"
                    select="com.acorn.springboardstudy.mapper.BoardReplyMapper.findByBIdAndParentBrIdIsNull"
                    column="b_id"
                    fetchType="lazy"/>

        <!-- ðŸcollection - ì¡°íšŒ(ì¶œë ¥) // join ì•ˆí•˜ê³  ì»¬ë ‰ì…˜ì—ì„œ select ë¡œ í˜¸ì¶œ(join ê³¼ ê°™ì´ ë™ìž‘) // Mapper ì¸í„°íŽ˜ì´ìŠ¤ í•„ìš” -->
        <collection property="imgs"
                    select="com.acorn.springboardstudy.mapper.BoardImgMapper.findByBId"
                    column="b_id"
                    fetchType="lazy"/> <!-- ì¡°íšŒí•˜ëŠ” ê³³ì—ì„œë§Œ ì¡°ì¸ì²˜ëŸ¼ ì¡°íšŒ í•˜ê² ë‹¤. -->

        <!--  ðŸŽcollection ë³µí•©ê´€ê³„ ë§µí•‘ (ðŸ1:N join í–ˆì„ë•Œ ì‚¬ìš©) => ðŸjoin ì•ˆí•˜ê³  ì»¬ë ‰ì…˜ì—ì„œ select ë¡œ í˜¸ì¶œí•˜ê¸°(ê¶Œìž¥) -->
        <!--  ofType : imgs ë¦¬ìŠ¤íŠ¸ì˜ ì œë„¤ë¦­ì— ë“¤ì–´ê°ˆ ë°ì´í„° íƒ€ìž… // List <BoardImgDto>  -->
            <!-- ðŸê²°ê³¼ : resultMap BoardDto ì˜ í•„ë“œ imgs -> BoardDto.imgs , List<BoardImgDto> ë¦¬ìŠ¤íŠ¸íƒ€ìž…, ì œë„¤ë¦­ì€ BoardImgDto íƒ€ìž… -->
            <!-- ðŸcollection ì˜ javaType="java.util.List" ëŠ” ê¸°ë³¸ê°’ì´ë‹¤. ì•ˆì¨ë„ ì ìš©ë˜ìžˆìŒ  -->
<!--        <collection property="imgs" ofType="BoardImgDto" javaType="java.util.List">  -->
<!--            <id property="biId" column="bi_id"/>-->
<!--            <result property="bId" column="b_id"/>-->
<!--            <result property="imgPath" column="img_path"/>-->

<!--            ðŸí…Œì´ë¸” ì»¬ëŸ¼ëª…, dto í•„ë“œëª…ì´ ê°™ì€ë° ì´ë ‡ê²Œ ëª…ì‹œë¥¼ í•˜ëŠ” ì´ìœ !
                => collection, association ì•ˆì— ë§µí•‘í•  í•„ë“œë¥¼ ê¼­ ë„£ì–´ì¤˜ì•¼ í•´ì„œ! ì•ˆë„£ìœ¼ë©´ ê°’ì´ ì•„ë¬´ê²ƒë„ ì•ˆë“¤ì–´ì˜¨ë‹¤ -->
<!--            <id property="bi_id" column="bi_id"/>-->
<!--            <result property="b_id" column="b_id"/>-->
<!--            <result property="img_path" column="img_path"/>-->
<!--        </collection> -->



            <!-- select ëœ Mapper ì¸í„°íŽ˜ì´ìŠ¤ì˜ í•¨ìˆ˜ì˜ ì¡°íšŒê²°ê³¼ë¥¼ property ì˜ ë³€ìˆ˜ëª…ìœ¼ë¡œ ë‹´ëŠ”ê²ƒ! ë³€ìˆ˜ëª… user, replies ê°€ resultMap ì˜ BoardDto í´ëž˜ìŠ¤ì˜ í•„ë“œë¡œ ì¡°ì¸ì´ ëœë‹¤!! -->
            <!-- ë³´ë“œ : user ê´€ê³„  => N : 1  => associtation -->
            <!-- ë³´ë“œ : reply ëŒ“ê¸€ ê´€ê³„  => 1 : N  => collection -->
<!--        ðŸfetchType="eager" : ì¦‰ì‹œ ì¡°íšŒ(í˜¸ì¶œì´ ì—†ì–´ë„ ì¡°íšŒ == ì¡°ì¸ ê°™ì´ ë™ìž‘)ðŸ”¥
            / fetchType="lazy" : ì§€ì—°ë¡œë”©(í˜¸ì¶œì´ ìžˆëŠ”ì§€ ê²€ìƒ‰(ë·°) í›„ ìžˆìœ¼ë©´ ì¡°íšŒ) ex) ë¦¬ìŠ¤íŠ¸ì—ì„œ ëŒ“ê¸€ì´ í•„ìš”ì—†ìœ¼ë©´ ì¡°íšŒí•˜ì§€ ì•ŠìŒ.
            select="namespace.id" : resultMap ìœ¼ë¡œ ì¡°íšŒ(<select>)í•  ë•Œ <collection select ê°€ ìžˆìœ¼ë©´> í•´ë‹¹ í•„ë“œ()ë¥¼ ë‹¤ë¥¸ ë‚´ì—­ì„ ì¡°íšŒí•´ì„œ íŒŒì‹±
            column="b_id : ì¡°íšŒí•  sql ì˜ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•  ì¹¼ëŸ¼

            ì„œë¹„ìŠ¤ì• ì†Œ ì‹¤ì œë¡œ ì¡°ì¸ì€ ê±°ì˜ ì—†ë‹¤ - fetchType ìœ¼ë¡œ ì¡°ì¸ íš¨ê³¼ë¥¼ ë‚¸ë‹¤.
        -->


<!--        resultMap.collection  =>  1:N or N:N    ê´€ê³„(ë¦¬ìŠ¤íŠ¸)ì¼ë•Œ ì¡°íšŒí•˜ëŠ” ë°©ë²• -->
<!--        resultMap.association  => N:1 or 1:1     ê´€ê³„ ì¼ë•Œ ì¡°íšŒí•˜ëŠ” ë°©ë²•  -->
<!--        resultMap ìœ¼ë¡œ ì¡°íšŒë¥¼ í• ë•Œ, BoardReplyMapper.findByBIdAndParentBrIdIsNull ê°€ ì¡°íšŒê°€ ë˜ê³ , ì¡°íšŒëœ ë‚´ì—­ì´ replies ì— ë“¤ì–´ì˜¨ë‹¤.
            ì¡°ê±´ì€ b_id (ì¡°íšŒí• ë•Œ, replies ë„ ì¡°íšŒí•˜ê¸° => ì¡°ì¸!)
-->
        <!-- 1:1 ë˜ëŠ” 1:N ì¡°ì¸ / ì„œë¸Œì¿¼ë¦¬ë¡œ ì“¸ ìˆ˜ ìžˆë‹¤. -->
    </resultMap>
    <!-- namespace ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§µí¼ë¥¼ ìƒì„±í•˜ê² ë‹¤. -->
    <!-- SELECT LAST_INSERT_ID : auto increment ë¡œ ë°©ê¸ˆ ìƒì„±ëœ id ë²ˆí˜¸
        useGeneratedKeys="true" : auto increment ë¡œ pk ë¥¼ ìƒì„±í•˜ëŠ”ê°€? // LAST_INSERT_ID í˜¸ì¶œ
        keyProperty="bId" : íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ BoardDto ì— (keyproperty == boardDto ì˜ í•„ë“œëª… ê°€ ìžˆë‹¤.) auto increment ë¡œ ìƒì„±ëœ í‚¤ë¥¼ ë°˜í™˜í•˜ê² ë‹¤.
    -->
    <!-- ðŸŽ2023.3.29 ë‚´ ê°œì¸ì ìœ¼ë¡œ ì²˜ìŒì— maven í´ë” ë§Œë“¤ê³  gradle í´ë”ë¡œ ì˜®ê¸°ë©´ì„œ, Mapper ì¸í„°íŽ˜ì´ìŠ¤ ì—°ê²°ì´ ìž˜ ì•ˆë˜ì„œ, íŒŒë¼ë¯¸í„° íƒ€ìž…ì„ ì „ì²´ ê²½ë¡œë¡œ ê°•ì œ ì§€ì •í•¨  -->
    <!-- BoardDto ì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ bId ì— ìžë™ìƒì„±ëœ ê°’ì„ ë‹´ì•„ì„œ ë‹¤ì‹œ BoardDto ì— -->
    <insert useGeneratedKeys="true" keyProperty="bId" id="insertOne" parameterType="BoardDto">
        INSERT INTO boards (u_id, title, content) VALUE (#{uId},#{title},#{content})
    </insert>
    <update id="updateOne" parameterType="BoardDto">
        UPDATE boards SET title=#{title}, content=#{content} WHERE b_id=#{bId}
        <!-- íŒŒë¼ë¯¸í„°. BoardDto ê°€ ê°€ì§„ í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ ë°›ëŠ”ë‹¤. -->
        <!-- íŒŒë¼ë¯¸í„° íƒ€ìž…ì€ ìƒëžµê°€ëŠ¥í•˜ë‹¤. -->
    </update>
    <update id="updateStatusByBId" parameterType="BoardDto">
        <!-- íŒŒë¼ë¯¸í„°íƒ€ìž…ì„ ì•ˆì ì–´ë„ ë§ˆì´ë°”í‹°ìŠ¤ê°€ ìžë™ìœ¼ë¡œ íŒŒë¼ë¯¸í„°íƒ€ìž…ì„ ë§žì¶°ì¤€ë‹¤ - ì´ìœ ëŠ”? id ì— í•´ë‹¹ íŒŒë¼ë¯¸í„° íƒ€ìž…ìœ¼ë¡œ ì“¸ Dto ì˜ í•¨ìˆ˜ ì´ë¦„ì„ ì ì—ˆê¸° ë•Œë¬¸ì— -->
        UPDATE boards SET status=#{status} WHERE b_id=#{bId}
    </update>
    <update id="updateIncrementViewCountBId">
        UPDATE boards SET view_count=(view_count+1) WHERE b_id=#{bId}
    </update>
    <!--    <update id="updateStatusByBId">-->
<!--        UPDATE boards SET status=#{status} WHERE b_id=#{bId}-->
<!--    </update>-->
    <delete id="deleteOne">
    <!-- <delete id="deleteOne" parameterType="int"> -->
        <!-- íŒŒë¼ë¯¸í„° íƒ€ìž… int ë¡œ ì ê¸° -> ì•ˆì ì–´ë„ ëœë‹¤
             int ë¡œ ì ëŠ”ê±´ ë°›ëŠ” ë§¤ê°œë³€ìˆ˜ê°€ int íƒ€ìž… b_id í•˜ë‚˜ë¼ì„œ,
             ë§Œì•½ íŒŒë¼ë¯¸í„°ê°€ 2ê°œê°€ ì˜¨ë‹¤ê³  í–ˆì„ë•Œ, int b_id, String name ì´ëŸ°ì‹ì¼ë•Œ, íŒŒë¼ë¯¸í„°íƒ€ìž…ì„ int ë˜ëŠ” string ì–´ë–¤ê²ƒìœ¼ë¡œ í• ì§€ ì •í• ìˆ˜ ì—†ì–´ì„œ ì•ˆì ëŠ”ê±°ê³ ,
             ì• ì´ˆì— íŒŒë¼ë¯¸í„° íƒ€ìž…ì„ ì•ˆ ì ì–´ë„ ë§ˆì´ë°”í‹°ìŠ¤ê°€ ìžë™ìœ¼ë¡œ í•´ë‹¹ id í•¨ìˆ˜ì˜ íƒ€ìž…ìœ¼ë¡œ ë§žì¶°ì¤€ë‹¤.
        -->
        DELETE FROM boards WHERE b_id=#{bId}
    </delete>


    <!-- ë³´ë“œ_ê²Œì‹œê¸€_ë¦¬ìŠ¤íŠ¸ // SELECT ë¬¸ // ë³´ë“œë§µì—ì„œ ë³´ë“œë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¬ë•Œ -->
    <select id="findAll" resultMap="BoardMap">
        <!-- ëª¨ë“ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë³€ìˆ˜ë¥¼ ë“±ë¡í• ìˆ˜ìžˆë‹¤ => loginUserId íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë³€ìˆ˜ë¡œ ìŠ¤ê¸° -->
        SELECT *  FROM boards

    </select>


<!--    # ë³µí•©ê°ì²´ë§µí•‘-->
<!--    # SELECT b.*,u.name 'user.name' FROM boards b INNER JOIN users u USING (u_id)-->
<!--    #  u.name (users í…Œì´ë¸”ì˜ í•„ë“œ)ë¥¼ resultMap ì˜ BoardMap ì˜ í•„ë“œ user(ìœ ì €ì •ë³´)ì˜ í•„ë“œ name -> user.name ìœ¼ë¡œ ë§µí•‘í• ìˆ˜ìžˆë‹¤.-->

    <!--  ðŸ”¥ë³µìž¡ê°ì²´ë§µí•‘ : ì¡°ì¸í•´ì„œ ë“¤ê³ ì˜¨ ê²°ê³¼ë¬¼ì„ ë³´ë“œë§µì— ìžˆëŠ” ìœ ì €ì˜ í•„ë“œì™€ ë§µí•‘í•  ìˆ˜ ìžˆë‹¤. -->
    <!-- í•„ë“œëª…ì´ëž‘  íŒŒë¼ë¯¸í„° ì´ë¦„ì´ ë‹¤ë¥´ë©´ ê°’ì´ ì•ˆë°›ì•„ì§„ë‹¤ -->
    <!-- resultMap ì´ í…Œì´ë¸”ì˜ row í•˜ë‚˜í•˜ë‚˜ë¥¼ ë¥¼ ë§µí•‘í•œë‹¤ => association ì´ ìžˆìœ¼ë©´ ì¶œë ¥ë˜ëŠ” u_id ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ê°€ì ¸ì™€ì„œ ë§µí•‘ -->
    <!-- association : ì¡°ì¸ì„ í•˜ëŠ”ê²ƒë³´ë‹¤ ì¿¼ë¦¬ì˜ ìž¬ì‚¬ìš©ì„±ì´ ë†’ë‹¤. // ì§€ì—°ë¡œë”©(lazy)ì„ í•  ìˆ˜ìžˆë‹¤.(ì¡°íšŒí•˜ê³  ì‹¶ì§€ ì•Šì„ë•Œ ì¡°íšŒí•˜ì§€ ì•Šì„ ìˆ˜ ìžˆë‹¤)-->
    <!-- mybatis ê°€ í˜¸ì¶œì„í•˜ëŠ”ì§€ ë³¸ë‹¤ - association ì— ìžˆëŠ” ê²ƒì„ ì œì™¸í•œë‹¤ => ì´ê²Œ ì§€ì—°ë¡œë”© -->
<!--    #     í˜¸ì¶œì„ í•˜ë©´ mybatisê°€ ê·¸ê²ƒì„ ë³´ê³ , association ì„ ì‹¤í–‰ => ì´ê²Œ ì§€ì—°ë¡œë”©-->
<!--    #     spring mybatis ëŠ” ì¿¼ë¦¬ ì‚¬ìš©ì„ ë³´ê³  ìžˆë‹¤ê°€ ì“°ë©´ ì•ˆì“°ë©´-->
<!--    #     ì§€ì—°ë¡œë”© -> ë°ì´í„° ì ˆê° => ë¹„ìš©ì ˆê°, ì†ë„í–¥-->


    <select id="findByBId" resultMap="BoardMap">
        SELECT * FROM boards WHERE b_id=#{bId}
        <!-- bId : findByBId í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ë°›ëŠ”ë‹¤. -->
    </select>




<!--     ðŸ association ì€  N : 1 join (ê²°ê³¼ 1ê°œ ë°˜í™˜) /  collection ì€  1 : N join (ê²°ê³¼ ì—¬ëŸ¬ê°œ(List) ë°˜í™˜)
            association ì€ resultType ìœ¼ë¡œë„ ë§µí•‘,ì¡°ì¸ ê°€ëŠ¥í•˜ì§€ë§Œ
            collection ì€ resultMap ìœ¼ë¡œë§Œ ë§µí•‘, ì¡°ì¸ ê°€ëŠ¥í•˜ë‹¤.
-->

<!--     1)ðŸ 1:N (ë³´ë“œ : ì´ë¯¸ì§€)ê´€ê³„ ì»¬ë ‰ì…˜ ë³µí•©ê´€ê³„ ë§µí•‘ ì¡°ì¸í•˜ëŠ” ë²• => resultMap ì—ì„œë„ collection ìœ¼ë¡œ ë³µí•©ë§µí•‘-->
<!--    <select id="findAll" resultMap="BoardMap">-->
<!--        SELECT * FROM boards b LEFT JOIN board_imgs i USING (b_id)-->
<!--        # SELECT b.*,i.bi_id 'imgs.bi_id' FROM boards b LEFT JOIN board_imgs i USING (b_id)-->
<!--        # board_imgs í…Œì´ë¸”ì˜ bi_id ì»¬ëŸ¼ëª…ì„ 'imgs.bi_id' ë¡œ ë‹¤ë¥¸ì´ë¦„(ë³„ì¹­)ìœ¼ë¡œ ì¡°íšŒ(ì¶œë ¥)-->
<!--    </select> -->
<!--     ðŸ 1:N  ë³µí•©ê´€ê³„ ë§µí•‘ì€ resultType ìœ¼ë¡œ ë§µí•‘ì´ ì•ˆë˜ê³ (ê²°ê³¼ê°€ ì•ˆë‚˜ì˜´), resultMap collection ìœ¼ë¡œ ë§µí•‘ì„ í•´ì•¼í•œë‹¤. -->
<!--        <select id="findAll" resultType="boardDto">-->
<!--            SELECT *,i.bi_id 'imgs.biId', i.img_path 'imgs.imgPath' FROM boards NATURAL JOIN board_imgs i-->
<!--            ðŸŽê²°ê³¼ : board_imgs í…Œì´ë¸”ì˜ bi_id ì™€ boardDto ì˜ imgs ì˜ í•„ë“œ biId ë¥¼ ë§µí•‘, ì´ë¦„ì„ ë§žì¶”ê² ë‹¤.
                   ì™œ? mybatis ê°€ resultType ìœ¼ë¡œ ì •ì˜ëœ DTO í•„ë“œëª…ê³¼ ë°˜í™˜ë˜ëŠ” í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ëª… ì´ë¦„ì´ ê°™ì•„ì•¼ì§€ ë§µí•‘ì„ í•´ì„œ ë°˜í™˜í•˜ë‹ˆê¹Œ! -->
<!--            ðŸ‰ i.bi_id => board_imgs í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ëª… bi_id    -->
<!--            ðŸ‰ 'imgs.biId'
                    1) imgs : resultType boardDto ì˜ í•„ë“œëª… // private List<BoardImgDto> imgs
                    2) BoardImgDto íƒ€ìž…ì˜ imgs ì˜ BoardImgDto ì˜ í•„ë“œëª… biId    -->
<!--        </select>-->


<!--     2)ðŸ N:1 (ë³´ë“œ : ìœ ì €) ê´€ê³„ ë³µí•©ê´€ê³„ ë§µí•‘ ì¡°ì¸ => ë³´ë“œ ì¡°íšŒì‹œ ìœ ì €ëŠ” í•œëª…ë§Œ ë‚˜ì˜¨ë‹¤.
            resultMap ì— association user ì—†ì–´ë„ ë¨, ë‹¨ resultMap ì— association ì´ ì—†ê¸° ë•Œë¬¸ì—
            resultType ì„ resultMap ì´ ì•„ë‹Œ boardDto ë¡œ ì§€ì •í•´ì¤˜ì•¼ í•œë‹¤. (resultMap ì— ì—†ìœ¼ë©´ resultMap ì„ resultType ìœ¼ë¡œ ì“¸ìˆ˜ ì—†ìŒ )-->

<!--        ðŸresultMap association user ë¥¼ ì“°ê²Œë˜ë©´ association ì´ ë§µí•‘ì„ í•´ì£¼ë¯€ë¡œ
            1) resultType ëŒ€ì‹  resultMap ì„ ì‚¬ìš©
            2) SELECT * FROM board NATURAL JOIN users ë¡œë§Œ í•´ë„ ëœë‹¤. (ì¹¼ëŸ¼ëª… ë³„ì¹­ìœ¼ë¡œ ë§µí•‘ ì•ˆí•´ë„ ëœë‹¤)
            'user.name' ì—ì„œ user ëŠ” boardDto ì—ì„œ private UserDto user ì˜  UserDto í•„ë“œ name ì„ ëœ»í•œë‹¤.-->

<!--        <select id="findAll" resultType="boardDto">-->
<!--            SELECT *,u.name 'user.name', u.phone 'user.phone' FROM boards NATURAL JOIN users u-->
<!--        </select>-->

</mapper>