<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- static í´ë” ì•ˆì— bootstrap í´ë” // bundle : ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨ -->
<!--<link rel="stylesheet" href="/bootstrap/css/bootstrap.css"> -->
<!--<script src="/bootstrap/js/bootstrap.bundle.js"></script>-->
<!-- ğŸ’control + space bar : ê²½ë¡œ ìë™ì™„ì„± -->
<!-- webjars : ì™¸ë¶€ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ bootstrap ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
<style>
    #tagListCont .list-group-item:hover { /* hover ë¬ì„ë•Œ */
        background-color: #31363b !important;
    }
</style>

<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">HOME</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/board/list.do">ê²Œì‹œíŒ</a> <!-- ë™ì í˜ì´ì§€ ê²½ë¡œì„¤ì •(/board/ ëŠ” ê°€ìƒê²½ë¡œ) -->
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/board/register.do">
                        ê²Œì‹œê¸€ ë“±ë¡
                        <i class="bi bi-plus-square"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/chat/room/list.do">
                        ì±„íŒ…ë°©
                        <i class="bi bi-chat"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <!--ì—´ë¦¬ëŠ” íƒ€ê²Ÿ - href="#offcanvasSearch" // ë²„íŠ¼ ì•„ë‹ˆê³  ë©”ë‰´ì¸ê²ƒì²˜ëŸ¼ nav-link -->
                    <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasSearch" role="button" aria-controls="offcanvasExample">
                        í•´ì‹œíƒœê·¸ ê²€ìƒ‰
                        <i class="bi bi-search"></i>
                    </a>
                </li>
            </ul>
            <div class="d-flex">
                <ul class="breadcrumb">
                    <!--          <th:> th ë¸”ëŸ­. êµ¬ë¶„ì, ì¤‘ê´„í˜¸ ê°™ì€ // ${ } : ë³€ìˆ˜ í‘œì‹œ -->
                    <th:block th:if="${session.loginUser==null}"> <!-- ë¡œê·¸ì¸ X / ì„¸ì…˜ì˜ ë¡œê·¸ì¸ìœ ì €ê°€ null ì´ë©´ -->
                        <li>
                            <a class="nav-link" href="/user/login.do">ë¡œê·¸ì¸</a>
                        </li>
                        <li>
                            <a class="nav-link" href="/user/signup.do">íšŒì›ê°€ì…</a>
                        </li>
                    </th:block>
                    <th:block th:if="${session.loginUser!=null}"> <!-- ë¡œê·¸ì¸ í–ˆì„ë•Œ / ì„¸ì…˜ì˜ ë¡œê·¸ì¸ìœ ì €ê°€ null ì•„ë‹ˆë©´ -->
                        <li class="breadcrumb-item">
                            <!-- íƒ€ì„ë¦¬í”„ ì£¼ì†Œ th:href ëŠ” ë¬´ì¡°ê±´ @{ } // íŒŒë¼ë¯¸í„° ì˜ì—­ ( ) // ë³€ìˆ˜ì°¾ê¸° ${  } -->
                            <!-- ğŸ’th:href (íŒŒë¼ë¯¸í„°ë¥¼ ìƒì„±í•´ì£¼ëŠ” ì†ì„±, url ì„ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒ)ê°€ ì¸ì½”ë”©ë„ í•´ì£¼ê³  íŒŒë¼ë¯¸í„°ë„ ë°›ì•„ì¤€ë‹¤ -->
                            <!-- ğŸ’${} ì“°ëŠ” ì´ìœ . url ì¸ì½”ë”©ì€ í•œê¸€ì´ ê¹¨ì§„ë‹¤.  -->
                            <!-- <a class="nav-link" th:href="@{'/user/detail.do'(uId=${session.loginUser.uId})}"> -->
                            <!--  =>?uId=${ } (ğŸ’UTF-8 ì¸ì½”ë”©(í•œê¸€ê¹¨ì§ X))  => http://localhost:8080/user/detail.do?uId=user01 -->
                            <!-- <a class="nav-link" th:href="@{'/user/detail.do'(uId='ê²½ë¯¼')}"> -->
                            <!--  => ?uId='ê²½ë¯¼' (ğŸ’url ì¸ì½”ë”©(í•œê¸€ê¹¨ì§ í˜„ìƒ)) => http://localhost:8080/user/detail.do?uId=%EA%B2%BD%EB%AF%BC -->

                             <a class="nav-link" th:href="@{'/user/{uId}/detail.do'(uId=${session.loginUser.uId})}">
                            <!-- ğŸpathVariable : detail.do í˜ì´ì§€ì— ê¼­ íŒŒë¼ë¯¸í„°ê°€ í•„ìš”í•œ ê²½ìš° ê²½ë¡œì— íŒŒë¼ë¯¸í„°ë¥¼ ë³´ë‚´ëŠ” ê²ƒ -->
                            <!-- => {uId} ì—  ${session.loginUser.uId} íŒŒë¼ë¯¸í„°ê°€ ë“¤ì–´ê°„ë‹¤. -->
                            <!-- http://localhost:8080/user/user01/detail.do -->
                            <span th:text="${session.loginUser.uId}"></span> <!-- íƒ€ì„ë¦¬í”„ê°€ get ì„ ìƒëµí•´ì¤€ë‹¤. GetUId ë¥¼  -->
                            (<span th:text="${session.loginUser.name}"></span>)
                            </a>
                        </li>
                        <li>
                            <a class="nav-link" href="/user/logout.do">/ ë¡œê·¸ì•„ì›ƒ</a>
                        </li>
                    </th:block>
                </ul>
            </div>

        </div>
    </div>
</nav>

<div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="offcanvasSearch" aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">í•´ì‹œíƒœê·¸ ê²€ìƒ‰</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="input-group">
            <label class="input-group-text bg-dark text-white">
                <i class="bi bi-hash"></i>
            </label>
            <!-- ê²€ìƒ‰ì°½ -->
            <input type="text" id="searchTagInput" class="form-control" placeholder="í•´ì‹œíƒœê·¸">
        </div>
        <hr>
        <!-- ê²€ìƒ‰í•œ í•´ì‹œíƒœê·¸ ë¦¬ìŠ¤íŠ¸ -->
        <div id="tagListCont" class="list-group">
        <!-- í•´ì‹œíƒœê·¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ë„£ëŠ”ë‹¤ (html ì„ ì»¨í¬ë„ŒíŠ¸í™” tagListComponent) => -->
        </div>
    </div>
</div>




<script>
    function tagListComponent(tagObj){ // tagObj : {"tag":"í™ëŒ€","bCnt":8}
        // html ì„ ì»¨í¬ë„ŒíŠ¸í™”
        return `
        <!--         íƒœê·¸ë¡œ ì¡°íšŒí•˜ëŠ” ë¦¬ìŠ¤íŠ¸ -->
            <a href="/board/${tagObj.tag}/tagList.do" class="list-group-item text-bg-dark d-flex align-items-center">
                <i class="bi bi-hash border rounded-circle fs-2 d-flex justify-content-center align-items-center" style="width:45px; height: 45px;"></i> <!-- ë™ê·¸ë¼ë¯¸ íš¨ê³¼ - border rounded-circle // ë™ê·¸ë¼ë¯¸ ëŠ˜ì–´ë‚¨ ì—†ì• ê¸°(d-flex) align-items-center -->
                <div class="ms-3">
                    <div>
                        <i class="bi bi-hash"></i> <!-- í•´ì‹œíƒœê·¸ ì•„ì´ì½˜ -->
                        <span>${tagObj.tag}</span> <!-- ë°›ì•„ì™€ì„œ ì¶œë ¥ -->
                    </div>
                    <div class="text-white text-opacity-75">
                        <small>ê²Œì‹œë¬¼</small>
                        <small>${tagObj.bCnt}</small>
                    </div>
                </div>
            </a>
        `;
    }
    const searchTagInput=document.getElementById("searchTagInput");
    const tagListCont=document.getElementById("tagListCont");
    searchTagInput.addEventListener("input",async (e)=>{ // input ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì´ë²¤íŠ¸ë¥¼ ë°œìƒí•˜ê² ë‹¤~!
        let tag=searchTagInput.value; // ì…ë ¥í•œ ê°’
        if(tag.length>0){
            const tags=await searchTags(tag);
            // console.log(tags);
            if(tags){ // tags ê°€ ìˆìœ¼ë©´
                tagListCont.innerHTML=""; // ê²€ìƒ‰ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™” í•˜ë©´ì„œ ì¶”ê°€í•˜ê¸°~!
                for(const tagObj of tags){ // == ìë°” for ( : )
                    tagListCont.insertAdjacentHTML("beforeend", tagListComponent(tagObj)); // tagListCont íƒœê·¸ ì•ˆì— í•´ì‹œíƒœê·¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹´ëŠ”ë‹¤.
                    // tags => [{"tag":"í™ëŒ€","bCnt":8},{"tag":"í™ëŒ€ë†€ì´í„°","bCnt":1},{"tag":"í™ëŒ€ë§›ì§‘","bCnt":2},{"tag":"í™ëŒ€ì• ê²¬","bCnt":0},{"tag":"í™ëŒ€ì…êµ¬","bCnt":0},{"tag":"í™ëŒ€ì¹´í˜","bCnt":0}]
                }
            }
        }
    });
    async function searchTags(tag){
        let url=`/hashtag/${tag}/search.do`
        const resp=await fetch(url);
        if(resp.status===200){
            return await resp.json(); // json ì‘ë‹µì„ ë°˜í™˜ {"tag": "í™ëŒ€", "bCnt": "10"} keyëŠ” value ë¡œ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œ
            // ğŸ’resp.json()ì€ HTTP ì‘ë‹µ ê°ì²´ì—ì„œ JSON ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ JavaScript ê°ì²´ë¡œ ë³€í™˜
        }
    }

</script>

<th:block th:if="${msg!=null || session.msg!=null}"> <!-- msg ë©”ì„¸ì§€ê°€ ìˆìœ¼ë©´ (null ì´ ì•„ë‹ˆë©´) -->
    <div id="actionModal" class="modal" tabindex="-1"> <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ modal ì„ ì°¾ê¸°ìœ„í•´ id ê°’ì„ ì¤€ë‹¤.(ëª¨ë‹¬ì°½ ì•ˆë– ì„œ) -->
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ì•¡ì…˜ ë©”ì„¸ì§€</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p th:text="${msg}"></p>
                    <p th:text="${session.msg}"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- íƒ€ì„ë¦¬í”„ ë¬¸ì„œì—ì„œ session ì„ ì‚­ì œí•  ìˆ˜ ì—†ë‹¤. -->
    <script th:inline="javascript">
        /*  session.removeAttribute("msg")  // ì›ë˜ëŠ” ë¬ëŠ”ë° ë²„ì „ì´ ë°”ë€Œë©´ì„œ ì•ˆë˜ëŠ”ê±°(íƒ€ì„ë¦¬í”„ì—ì„œ ì„¸ì…˜ê°ì²´ ì‚­ì œ(ì‚¬ìš©í›„ ì§€ìš°ê¸°)í• ìˆ˜ì—†ë‹¤)*/
        const actionModal=document.getElementById("actionModal");
        // ë¶€íŠ¸ìŠ¤íŠ¸ë© ê°ì²´ ìƒì„±ì‹œ ëª¨ë‹¬ì°½ ë„ìš°ê¸°( show() )
        new bootstrap.Modal(actionModal).show();
    </script>



    <!-- ğŸëª¨ë‹¬ì°½  -->
<!--    <script th:inline="javascript"> &lt;!&ndash; th ì•ˆì— ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•! &ndash;&gt;-->
<!--    alert(`[[${msg}]]`) //  ì„¸ì…˜ì„ ì´ìš©í•œ ëª¨ë‹¬ ì°½ ë„ìš°ëŠ” ë°©ë²•-->
<!--    </script>-->
</th:block>
</html>