<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout}">
<!-- ğŸ‰layout:decorate í˜„ì¬ í˜ì´ì§€ë¥¼ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ê¾¸ë¯¸ê² ë‹¤
        / ì»¨í…ìŠ¤íŠ¸ëŠ” ë£¨íŠ¸ ê²½ë¡œ
        /layout.html íŒŒì¼ì„ ì°¾ì•„ì„œ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì‚¬ìš©í•˜ê² ë‹¤.-->
<head>
    <meta charset="UTF-8">
    <title>í•´ì‹œíƒœê·¸ ê²€ìƒ‰ ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸</title>
    <script src="/public/js/BoardLike.js" defer></script>
</head>
<div layout:fragment="content">
    <h1 class="mt-4">í•´ì‹œíƒœê·¸ ê²€ìƒ‰</h1>
    <h2 class="mb-4">
        <i class="bi bi-hash"></i>
        <span th:text="${tag}"></span>
    </h2>
<!--    <p th:text="${page}"></p>-->
  <!-- ğŸ‰ê²Œì‹œê¸€ ì¢‹ì•„ìš” ajax -->
<!--    <p th:text="${boards}"></p>--> <!-- ê²Œì‹œê¸€ ë¶ˆëŸ¬ì™€ì§€ëŠ”ì§€ ì²´í¬ (ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ boards ê°ì²´ë¥¼ ë³´ëƒ„)-->
    <section id="boardListCont" class="row row-cols-lg-2 row-cols-1 g-5"> <!-- g : ìš”ì†Œê°„ì˜ ê°„ê²© --> <!-- md ì‚¬ì´ì¦ˆì¼ë•Œë§Œ, ê·¸ë¦¬ë“œì˜ ë¹„ìœ¨ì„ 3ê°œë¡œ / row-cols-1 : ìŠ¤ëª°ì‚¬ì´ì¦ˆì¼ë•Œ -->
        <th:block th:include="/board/includeList.html"></th:block>
    </section>

    <script> // ìŠ¤í¬ë¡¤ í˜ì´ì§• - 1.ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì— ë‹¿ì„ë•Œ, 2.ë‹¤ìŒ í˜ì´ì§€ê°€ section íƒœê·¸ ì•ˆì— ë¶ˆëŸ¬ì™€ì§„ë‹¤.
        // ë¸Œë¼ìš°ì € - ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
        let page=1;
        let lastPage=[[${boards.pages}]]; // í˜ì´ì§•í—¬í¼ pages : ë§ˆì§€ë§‰ í˜ì´ì§€
        const boardListCont=document.getElementById("boardListCont");
        window.addEventListener("scroll",async ()=>{ // ìŠ¤í¬ë¡¤ì´ë²¤íŠ¸ ë°œìƒì‹œ, ì´ë²¤íŠ¸ ì‹¤í–‰
            // console.log("ì›€ì§ì´ëŠ” ì¤‘");

            let scrollTop=document.documentElement.scrollTop || document.body.scrollTop; // ğŸ’ìŠ¤í¬ë¡¤ì˜ ìœ„ì¹˜ // ë¸Œë¼ìš°ì €ë§ˆë‹¤ í¬ë¡¬ - documentElement, ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œëŠ” body
            let clientHeight=document.documentElement.clientHeight || document.body.clientHeight; // ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¬ë¼ì„œ ì“°ê³ ìˆëŠ” í•„ë“œëª…ì´ ë‹¬ë¼ì„œ ì¡°ê±´ì„ 2ê°œë¥¼ ì¤€ë‹¤.
            let scrollHeight=document.documentElement.scrollHeight || document.body.scrollHeight;
            scrollHeight-=clientHeight; // scrollHeight=scrollHeight-clientHeight
            // console.log(scrollTop, clientHeight,scrollHeight);
            if(scrollTop===scrollHeight){ // ë°”ë‹¥ì„ ì²´í¬
                // console.log("ë°”ë‹¥ì…ë‹ˆë‹¤.")
                if(lastPage===page) { // ë°”ë‹¥ì„ ì³¤ì„ë•Œ ì•ŒëŒí‘œì‹œ ë° ë©”ì„œë“œ ì¢…ë£Œ
                    alert("ë§ˆì§€ë§‰ í˜ì´ì§€ì…ë‹ˆë‹¤.");
                    return; // ë©”ì„œë“œ ì¢…ë£Œ. ë‹¤ìŒì½”ë“œ ì‹¤í–‰ì•ˆë¨.
                }

                let list=await loadTagList(page+1); // 2ë²ˆ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
                if(list){ // list ê°€ true ì¼ë•Œ, ì¦‰ 2ë²ˆí˜ì´ì§€ ë¶ˆëŸ¬ì˜¤ëŠ”ê²Œ ì„±ê³µí•˜ë©´!
                    ++page; // ë‹¤ìŒ í˜ì´ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
                    boardListCont.insertAdjacentHTML("beforeend",list);
                }else {
                    alert("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                }
            }
        })

        async function loadTagList(pageNum){
            // let path=window.location.pathname; // '/board/%ED%99%8D%EB%8C%80/tagList.do'
            // let url=path+"?pageNum="+pageNum;
            let url="/board/[[${tag}]]/ajaxTagList.do?pageNum="+pageNum;
            const resp=await fetch(url);
            if(resp.status===200){
                return await resp.text(); // resp.text() : html ë¡œ ë°›ì•„ì˜¤ê¸°
            }else {
                alert("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
            }
        }


    </script>
    <br><br><br><br><br><br><br><br><br><br>
    <br><br><br><br><br><br><br><br><br><br>
</div>
</html>