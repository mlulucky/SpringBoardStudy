<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout}">
<head>
    <meta charset="UTF-8">
    <title>Í≤åÏãúÌåê ÏÉÅÏÑ∏</title>
</head>
<div layout:fragment="content">
    <h1 class="my-4">Í≤åÏãúÌåê ÏÉÅÏÑ∏</h1>
<!--    <p th:text="${boards}"></p>--> <!-- Í≤åÏãúÍ∏Ä Î∂àÎü¨ÏôÄÏßÄÎäîÏßÄ Ï≤¥ÌÅ¨ (Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú boards Í∞ùÏ≤¥Î•º Î≥¥ÎÉÑ)-->
    <section id="boardCont" class=""> <!-- g : ÏöîÏÜåÍ∞ÑÏùò Í∞ÑÍ≤© --> <!-- md ÏÇ¨Ïù¥Ï¶àÏùºÎïåÎßå, Í∑∏Î¶¨ÎìúÏùò ÎπÑÏú®ÏùÑ 3Í∞úÎ°ú / row-cols-1 : Ïä§Î™∞ÏÇ¨Ïù¥Ï¶àÏùºÎïå -->
        <div class="row"> <!-- display Í∞Ä md Ïù¥ÏÉÅÏùºÎïå ÌîåÎ†âÏä§ -->
            <div id="carouselExampleControls2" class="carousel slide d-none d-md-block col pe-0" data-bs-ride="carousel"> <!-- d-none d-md-block : ÏïàÎ≥¥ÏòÄÎã§Í∞Ä display md Ïù¥ÏÉÅÏùºÎïå Î≥¥Ïù¥Í≤å  -->
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="/public/img/board/Ï∂òÏãùÏù¥ÎùºÏù¥Ïñ∏.jpg" class="d-block w-100" alt="Í≤åÏãúÍ∏Ä Ïù¥ÎØ∏ÏßÄ">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
            <div class="col ps-0"> <!-- card Ïóê col ÏùÑ Ï£ºÎ©¥ Ïó¨Î∞±Ïù¥ ÏÉùÍ≤®ÏÑú col, card Îî∞Î°ú Ï£ºÍ∏∞ -->
                <!-- üçèÏª¥Ìì®ÌÑ∞ ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî Î∏åÎùºÏö∞Ï†Ä ÌÅ¨Í∏∞ : viewport ÌÅ¨Í∏∞ , ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî ÎÜíÏù¥ : 100vh (100%) -->
                <div class="card col" style="height: 70vh; overflow-y: auto"> <!-- boards Ïùò ÏöîÏÜåÎßåÌÅºÏùÑ Î∞òÎ≥µÌï¥ÏÑú ÌïòÎÇòÏî© Î∞∞Ïò§Í∏∞ (Î∞òÎ≥µÎ¨∏) -->
<!--                <div class="card col overflow-scroll" style="height: 70vh;"> &lt;!&ndash; boards Ïùò ÏöîÏÜåÎßåÌÅºÏùÑ Î∞òÎ≥µÌï¥ÏÑú ÌïòÎÇòÏî© Î∞∞Ïò§Í∏∞ (Î∞òÎ≥µÎ¨∏) &ndash;&gt;-->
                    <div class="card-header d-flex justify-content-between align-items-center
                                bg-light position-sticky top-0" style="z-index: 999"> <!-- Ïò§Î•∏Ï™Ω ÎÅùÏúºÎ°ú Î≥¥ÎÇ¥Í∏∞ / stretch ÏÜçÏÑ±ÏúºÎ°ú ÏïÑÏù¥ÏΩòÏù¥ ÏúÑÎ°ú Ïò¨ÎùºÍ∞ÑÎã§ => ÏÑ∏Î°úÏ§ëÏïÑ ÎßûÏ∂îÍ∏∞ align-items-center -->
                        <!--  sticky ÏÜçÏÑ±ÏúºÎ°ú ÌÉúÍ∑∏Í∞Ä Îî∞ÎùºÏò®Îã§.  -->
                        <div>
                            <!-- ÏûàÏùÑÎïåÎßå Ïù¥ÎØ∏ÏßÄÎ•º Ï∂úÎ†•ÌïòÍ≤†Îã§ th:if="${b.user.imgPath!=null}" -->
                            <img  th:if="${b.user.imgPath!=null}"
                                  th:src="@{'{path}'(path=${b.user.imgPath})}"
                                  alt="ÌîÑÎ°úÌïÑÏù¥ÎØ∏ÏßÄ"
                                  style="width: 50px; object-fit: cover;" class="img-thumbnail"> <!-- object-fit:cover - ÏÇ¨ÏßÑÎπÑÏú® ÎßûÏ∂∞Ï§ÄÎã§. -->
                            <strong class="ms-2" th:text="${b.user.uId}"></strong> <!-- margin-start -->
                            (<strong th:text="${b.user.name}"></strong>)
                        </div>
                        <div class="dropdown">
                            <a href="#" role="button" class="" data-bs-toggle="dropdown"> <!-- aÌÉúÍ∑∏ Î≤ÑÌäºÏúºÎ°ú Ïó≠Ìï†Ï£ºÍ∏∞ -->
                                <i class="bi bi-three-dots fs-4"></i> <!-- fs : font-size --> <!-- ÏõπÏûêÎ•¥ ÎùºÏù¥Î∏åÎü¨Î¶¨Îäî Ï∂îÍ∞ÄÌõÑÏóê ÏÑúÎ≤ÑÎ•º ÍªèÎã§ ÏºúÏïº Ï†ÅÏö©Ïù¥ ÎêúÎã§. -->
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" th:href="@{'/board/{bId}/detail.do'(bId=${b.bId})}">Í∏Ä ÏÉÅÏÑ∏</a>
                                </li>
                                <li><a class="dropdown-item" href="#">Í∏ÄÏì¥Ïù¥Í∞Ä ÏûëÏÑ±Ìïú Í∏ÄÎ™©Î°ù</a></li>
                                <li><a class="dropdown-item" href="#">Í≥ÑÏ†ï Ï†ïÎ≥¥</a></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="#">
                                        <i class="bi bi-bell"></i>
                                        Ïã†Í≥†
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="carouselExampleControls" class="carousel slide d-md-none" data-bs-ride="carousel"> <!-- d-md-none : display md Ïù¥ÏÉÅÏùºÎïå ÏïàÎ≥¥Ïù¥Í≤å  -->
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img src="/public/img/board/Ï∂òÏãùÏù¥ÎùºÏù¥Ïñ∏.jpg" class="d-block w-100" alt="Í≤åÏãúÍ∏Ä Ïù¥ÎØ∏ÏßÄ">
                                </div>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                        <div>
                            <div class="d-flex my-2">
                                <div class="me-2">
                                    ÏûëÏÑ±Ïùº : <small th:text="${#dates.format(b.postTime,'yyy-MM-dd')}"></small> <!-- date.format(Îç∞Ïù¥Ìä∏Í∞ùÏ≤¥, Ìè¨Îß∑) ÏúºÎ°ú ÎÇ†Ïßú ÏòàÏÅòÍ≤å ÏàòÏ†ïÌïòÍ∏∞ -->  <!-- b.postTime ÏûêÎ∞îÍ∞ùÏ≤¥ : Tue Mar 28 11:34:12 KST 2023 -->
                                </div>
                                <div>
                                    ÏàòÏ†ïÏùº : <small th:text="${#dates.format(b.updateTime,'yyy-MM-dd')}"></small>
                                </div>
                            </div>
                            <h5 class="card-title" th:text="${b.title}"></h5>
                            <p class="card-text" th:text="${b.content}"></p>
                            <hr>
                            <h6 class="card-title d-flex justify-content-between align-items-center">
                                <span>ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏</span>
                                <button type="button" class="btn btn-light" th:onclick="loadReplies([[${b.bId}]])">ÏÉàÎ°úÍ≥†Ïπ®</button>
                            </h6>
                            <div id="replyCont"> <!-- ÎåìÍ∏Ä -->
<!--                                <p th:text="${b.replies}"></p>-->
                                    <ul class="list-group"> <!-- overflow ÎÑòÏπòÎ©¥ scroll Ï£ºÍ≤†Îã§. -->
                                        <li class="list-group-item" th:each="r:${b.replies}">
                                            <th:block th:include="/reply/detail"></th:block> <!-- reply Ìè¥ÎçîÏïàÏóê detail.html ÌååÏùº  -->
                                        </li>
                                    </ul>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer position-sticky bottom-0 bg-light">
                        <div class="d-flex align-items-center">
                            <div class="likesCont"> <!-- Ìà¥ÌåÅ - Î†àÏù¥ÏïÑÏõÉÌååÏùºÏóê ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞ÄÌï¥ÏïºÌï®. -->
                                <a href="#" class="btn btn-sm btn-link" data-bs-toggle="tooltip" data-bs-title="Ï¢ãÏïÑÏöî" data-bs-placement="top">
                                    <i class="bi bi-emoji-heart-eyes text-danger fs-4"></i> <!-- bi : bootstrap icon -->
                                    <span th:text="${b.likes.like}"></span> <!-- ÏßÄÏó∞Î°úÎî©ÏúºÎ°ú Î∂àÎü¨Ïò®Îã§ -->
                                </a>
                                <a href="#" class="btn btn-sm btn-link" data-bs-toggle="tooltip" data-bs-title="ÏµúÍ≥†Ïïº" data-bs-placement="top">
                                    <i class="bi bi-emoji-sunglasses fs-4"></i>
                                    <span th:text="${b.likes.best}"></span>
                                </a>
                                <a href="#" class="btn btn-sm btn-link" data-bs-toggle="tooltip" data-bs-title="ÎÇòÎπ†Ïöî" data-bs-placement="top">
                                    <i class="bi bi-emoji-expressionless fs-4"></i>
                                    <span th:text="${b.likes.bad}"></span>
                                </a>
                                <a href="#" class="btn btn-sm btn-link" data-bs-toggle="tooltip" data-bs-title="Ïä¨ÌçºÏöî" data-bs-placement="top">
                                    <i class="bi bi-emoji-frown fs-4"></i>
                                    <span th:text="${b.likes.sad}"></span>
                                </a>
                            </div>
                            <small class="text-muted">‚Ä¢</small>
                            <div class="viewCont ms-2"  data-bs-toggle="tooltip" data-bs-title="Ï°∞ÌöåÏàò" data-bs-placement="top">
                                <i class="bi bi-eye fs-4"></i>
                                Ï°∞ÌöåÏàò : <span th:text="${b.viewCount}"></span>
                            </div>
                        </div>

                        <!-- ÎåìÍ∏ÄÏûÖÎ†• ÌèºÏùÑ Î°úÍ∑∏Ïù∏ Ìïú ÏÇ¨ÎûåÏóêÍ≤åÎßå Î≥¥Ïó¨Ï§ÄÎã§. => th:if  // ÏïàÍ∑∏Îü¨Î©¥(Î°úÍ∑∏Ïù∏ ÏïàÌïú ÏÇ¨ÎûåÏù¥ ÌéòÏù¥ÏßÄÎ•º ÏöîÏ≤≠ÌïòÎ©¥) ÏóêÎü¨Î©îÏÑ∏ÏßÄÍ∞Ä Îú¨Îã§.-->
                        <form enctype="multipart/form-data" name="replyInsertForm" action="/reply/insert.do" method="post" th:if="${session.loginUser!=null}">
                            <!-- enctype="multipart/form-data"  blob ÌååÏùº_Ïù¥ÎØ∏ÏßÄ ÏùÑ Î≥¥ÎÇ¥Í≤†Îã§ -->
                            <!-- form enctype="application/x-www-form-urlencoded"  ÏøºÎ¶¨Ïä§Ìä∏ÎßÅÏùÑ Î¨∏ÏûêÏó¥Î°ú Î≥¥ÎÇ¥Í≤†Îã§ - url Ïù∏ÏΩîÎî© - Í∏∞Î≥∏Í∞í-->
                            <hr>
                            <!-- ÎåìÍ∏ÄÏùÄ Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨ÎûåÎßå Ïì∏ Ïàò ÏûàÎã§.// value Í∞íÏù¥ ÏÑúÎ≤ÑÎ°ú ÎÑòÏñ¥Í∞ÑÎã§. -->
                            <input type="hidden" name="uId" th:value="${session.loginUser.uId}">
                            <input type="hidden" name="bId" th:value="${b.bId}">

                            <div class="mb-2 row justify-content-end">
                                <div class="col-3 p-0"> <!-- form-control ÏùÄ 100%Í∞Ä ÎêòÎ†§ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê col ÏÜçÏÑ±Ïù¥ ÏïàÎ®πÏñ¥ÏÑú Îî∞Î°ú divÏóê ÏÜçÏÑ±ÏùÑ Î∂ÄÏó¨ -->
                                    <input placeholder="Î∂ÄÎ™®ÎåìÍ∏Ä" type="text" readonly class="form-control" name="parentBrId"> <!-- => BoardReplydto Ïùò parentBrIdÍ∞Ä Î∞õÎäîÎã§. --> <!-- ÎåìÍ∏Ä Îã¨Í∏∞ ÎàåÎ†ÄÏùÑÎïå ÎåìÍ∏ÄÏùò Î≤àÌò∏Í∞Ä Îì§Ïñ¥Ïò®Îã§. -->
                                </div>
                                <div class="col p-0"> <!-- col ÎÇòÎ®∏ÏßÄ ÎÑàÎπÑÎ•º Îã§ Í∞ñÍ≤†Îã§. -->
                                    <input placeholder="ÎåìÍ∏Ä" type="text" class="form-control" name="content">
                                </div>
                                <button class="btn btn-primary col-auto">Ï†úÏ∂ú</button>
                                <label class="btn btn-info col-auto"> <!-- col-auto : content-fit ÏöîÏÜåÏùò ÌÅ¨Í∏∞ÎßåÌÅº  -->
                                    <i class="bi bi-file-image text-light"></i>
                                    <input class="d-none" type="file" name="img">
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!--  ÎåìÍ∏Ä ÏàòÏ†ïÌèº Î™®Îã¨Ï∞Ω  -->
        <div id="replyModifyModal" class="modal" tabindex="-1">
            <div class="modal-dialog">
                <form class="modal-content" name="replyModifyForm" method="post" enctype="multipart/form-data">
                    <input type="text" name="bId"> <!-- Í≤åÏãúÍ∏ÄÏïÑÏù¥Îîî Î∞õÍ∏∞ -->
                    <input type="text" name="brId">
                    <input type="text" name="imgPath">
                    <div class="modal-header">
                        <h5 class="modal-title">Î¶¨Ìîå ÏàòÏ†ïÌèº</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div id="replyModifyModalBody" class="modal-body"> <!-- ÎÇ¥Ïö©Ïù¥ Îì§Ïñ¥Í∞ÄÎäî ÌÉúÍ∑∏ÏóêÎäî id Î•º Ï£ºÎäîÍ≤ÉÏù¥ Ï¢ãÎã§. -->
                        <p class="form-floating">
                            <input type="text" name="uId" readonly class="form-control" placeholder="Í∏ÄÏì¥Ïù¥">
                            <label>Í∏ÄÏì¥Ïù¥</label>
                        </p>
                        <p>
                            <img name="imgPath" src="" alt="ÎåìÍ∏Ä Ïù¥ÎØ∏ÏßÄ"> <!-- ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ -->
                        </p>
                        <p class="form-floating">
                            <input type="text" name="parentBrId" readonly class="form-control" placeholder="Ï∞∏Ï°∞ÌïòÎäî Î∂ÄÎ™® ÎåìÍ∏Ä">
                            <label>Ï∞∏Ï°∞ÌïòÎäî Î∂ÄÎ™® ÎåìÍ∏Ä</label>
                        </p>
                        <p>
                            <input type="file" name="img" class="form-control"> <!-- ÏàòÏ†ïÌïòÎäî Ïù¥ÎØ∏ÏßÄ -->
                        </p>
                        <p class="form-floating">
                            <input type="text" name="content" class="form-control" placeholder="ÎÇ¥Ïö©">
                            <label>ÎÇ¥Ïö©</label>
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">ÏàòÏ†ï</button>
                    </div>
                </form>
            </div>
        </div>

    </section>
    <script th:inline="javascript">
        const replyModifyModal=new bootstrap.Modal(document.getElementById("replyModifyModal"),{});
        const replyCont=document.getElementById("replyCont");
        const replyInsertForm=document.forms["replyInsertForm"]
        const replyModifyForm=document.forms["replyModifyForm"]
        // ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ÏóêÏÑú ÌÉÄÏûÑÎ¶¨ÌîÑ Î≥ÄÏàò ÏÇ¨Ïö©ÌïòÎ†§Î©¥ ÎåÄÍ¥ÑÌò∏ 2Í∞ú
        async function loadReplies(bId){
            let url=`/reply/${bId}/list.do`
            const resp=await fetch(url); // url ÌéòÏù¥ÏßÄ Î∂àÎü¨Ïò§Í∏∞ (ReplyController Ïóê ÏûàÎäî ÎèôÏ†ÅÌéòÏù¥ÏßÄ - /reply/list html Î†åÎçî Î∞òÌôò )
            if(resp.status==200){
                alert("ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ Î°úÎìú ÏÑ±Í≥µ");
                let text=await resp.text(); // html ÏùÑ ÌÖçÏä§Ìä∏Î°ú Í∞ÄÏ†∏Ïò¥.
                replyCont.innerHTML="";
                setTimeout(()=>{
                    replyCont.innerHTML="<h1>Î¶¨Î°úÎìú</h1>"+text; // InnerHTML Ïóê Î∞òÏòÅ
                },1000);

            }
            // console.log(text);
            // ajax ÎπÑÎèôÍ∏∞ ÌÜµÏã†ÏúºÎ°ú Î∂àÎü¨Ïò¨Í≤É => fetch / async,await
        }

        replyInsertForm.onsubmit=registerReply;

        async function registerReply(e){ // Îß§Í∞úÎ≥ÄÏàò e Î•º Î∞õÏïÑÏïº ÌïúÎã§.
            e.preventDefault();
            // multipart/form-data Î°ú ÏßÄÏ†ïÎêú form ÏùÄ new FormData(formNode) Í∞ùÏ≤¥Î•º ÏÉùÏÑ±Ìï¥ÏÑú body Ïóê Ï∂îÍ∞Ä
            const data=new FormData(replyInsertForm);
            let url="/reply/handler.do" // register:1(Îì±Î°ùÏÑ±Í≥µ), 0(Ïã§Ìå®)
            const resp=await fetch(url,{method:"POST", body:data});  // => blob Îç∞Ïù¥ÌÑ∞Î•º ÌååÎùºÎØ∏ÌÑ∞Î°ú Ï†ÄÏû•. Ï†ÑÏÜ°
            if(resp.status==200){
                const json=await resp.json(); // json ÏúºÎ°ú Î∂àÎü¨Ïò§Í∏∞
                if(json.register>0){
                    alert("Îì±Î°ùÏÑ±Í≥µ");
                    await loadReplies(replyInsertForm.bId.value);
                }
                console.log(json);
            }else {
                alert("Îì±Î°ùÏã§Ìå® status: " + resp.status);
            }
        }

        async function loadModifyReply(brId){ // ÏàòÏ†ïÌèº Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú Ïã§ÌñâÎêòÎäî Ìï®Ïàò
            // alert(brId); // Í∏∞Îä•ÌïòÎäîÏßÄ ÌÖåÏä§Ìä∏
            let url=`/reply/${brId}/detail.do`;
            const resp=await fetch(url);
            if(resp.status==200){
                const json=await resp.json();
                replyModifyModal.show();
            }else {
                alert("Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå® status:" + resp.status);
            }

        }


    </script>
</div>
</html>